version: '3.1'
services:
  mail:
    image: tvial/docker-mailserver:latest
    hostname: mail
    domainname: ${DOMAINNAME:?err}
    container_name: mail
    ports:
      - "25:25"
      - "143:143"
      - "587:587"
      - "993:993"
      volumes:
        - maildata:/var/mail
        - mailstate:/var/mail-state
        - maillogs:/var/log/mail
        - ./config/:/tmp/docker-mailserver/
      environment:
        - ENABLE_SPAMASSASSIN=0
        - SPAMASSASSIN_SPAM_TO_INBOX=0
        - ENABLE_CLAMAV=0
        - ENABLE_FAIL2BAN=0
        - ENABLE_POSTGREY=0
        - ONE_DIR=0
        - DMS_DEBUG=0
      cap_add:
        - NET_ADMIN
        - SYS_PTRACE

    volumes:
      maildata:
        driver: local
      mailstate:
        driver: local
      maillogs:
        driver: local

  mega-create:
    build: .
    domainname: ${DOMAINNAME:?err}
    env_file:
      - .env
    cap_add:
      - NET_ADMIN
      - SYS_PTRACE
    restart: always

  sshd:
    image: maxisme/sshd:latest
    volumes:
      - "~/.ssh:/root/.ssh"
    ports:
      - "3307:22"
    restart: always